@page "/users"
@inject IUserService UserService
@inject OtherServices OtherServices
@inject TescatDbContext Context
@inject NavigationManager NavigationManager



<UserSearch></UserSearch>
<button type="button" class="btn btn-primary" @onclick="CreateNewUser">Agregar Usuario</button>
<div class="container">
    <div class="row">

        @if (Users == null)
        {

            <p>Loading users...</p>

        }
        else
        {
            @foreach (var user in Users)
            {
                <UserCard User="user"></UserCard>
            }

        }
    </div>
</div>


@if (showAlert)
{
    <div class="overlay-alert">
        <div class="alert alert-success flex-reverse" role="alert">
            <button type="button" class="btn-close" @onclick="CloseAlert" aria-label="Close"></button>
            @localMessage
        </div>
    </div>
}



@code
{
    private List<User>? Users { get; set; }
    //private User[]? Users { get; set; }

    public string? localMessage;

    private bool showAlert = false;


    protected override async
       Task OnInitializedAsync()
    {
        //base.OnInitialized();
        try
        {
            Users = await UserService.GetAllUsers();

            localMessage = OtherServices.Message;
            if (localMessage != null) await ShowAndHideAlert();

        }
        catch (Exception ex)
        {
            Console.WriteLine($"Hubo un problema al cargar la informacion de los usuarios{ex.Message}");
        }
    }

    /*
    protected override async
        Task OnInitializedAsync()
    {
        users = await UserService.GetAllUsers();
    }
    */

    protected void CreateNewUser()
    {
        NavigationManager.NavigateTo("/addUser");
    }

    private void CloseAlert()
    {
        showAlert = false;
    }
    private async Task ShowAndHideAlert()
    {
        showAlert = true;
        StateHasChanged();  // Forzamos una actualización inmediata para mostrar el alerta

        await Task.Delay(5000);  // Espera 5 segundos

        showAlert = false;
        StateHasChanged();  // Forzamos una nueva actualización para ocultar el alerta
    }




}




